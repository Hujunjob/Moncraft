# 🔧 故障排除指南

## 常见问题解决方案

### 1. Tilemap 加载错误

**错误**: `this.map = this.scene.make.tilemap({ key: 'map' })` 报错

**解决方案**:
- ✅ 已修复：添加了错误处理和 fallback 系统
- 如果 tilemap 文件加载失败，会自动使用程序化生成的地图
- 检查浏览器控制台是否有加载错误信息

### 2. 静态资源路径问题

**问题**: 资源文件无法加载

**解决方案**:
```
public/
  assets/
    tilemaps/
      basic-map.json
```

确保文件在 `public` 目录中，Vite 会自动处理静态资源。

### 3. Croquet 连接问题

**问题**: 多人功能无法工作

**解决方案**:
1. 检查 `.env` 文件中的 API key
2. 确保网络连接正常
3. 查看浏览器控制台错误信息

### 4. 依赖安装问题

**错误**: npm install 失败

**解决方案**:
```bash
# 清理并重新安装
rm -rf node_modules package-lock.json
npm install
```

### 5. 端口被占用

**问题**: Port 3000 is in use

**解决方案**:
- Vite 会自动选择下一个可用端口 (3001, 3002, etc.)
- 或者手动指定端口: `npm run dev -- --port 3030`

## 调试步骤

### 1. 检查浏览器控制台
打开 F12 开发者工具，查看 Console 标签页：
- 绿色消息: 正常运行
- 黄色警告: 可忽略的警告
- 红色错误: 需要修复的问题

### 2. 验证文件结构
```
newgame/
├── public/
│   └── assets/
│       └── tilemaps/
│           └── basic-map.json
├── src/
│   ├── game/
│   │   ├── GameScene.js
│   │   ├── WorldMap.js
│   │   └── ...
│   └── ...
└── package.json
```

### 3. 测试基本功能
1. 启动游戏
2. 输入玩家名称
3. 检查绿色方块是否出现
4. 测试 WASD 移动
5. 查看左上角玩家信息

### 4. 测试多人功能
1. 在新浏览器标签页中打开相同URL
2. 使用不同玩家名称
3. 检查是否能看到其他玩家（红色方块）
4. 测试移动同步

## 预期行为

### 成功启动时应该看到:
- ✅ "Assets loaded successfully" 在控制台
- ✅ 绿色方块（本地玩家）
- ✅ 草绿色背景（地图）
- ✅ 左上角玩家信息
- ✅ "Connected" 状态

### 多人模式成功时应该看到:
- ✅ "Players: 2" (或更多)
- ✅ 红色方块（其他玩家）
- ✅ 移动同步

## 性能优化

### 1. 减少网络更新频率
```javascript
// 在 GameScene.js 中已设置
if (now - this.lastPlayerUpdate > 50) { // 20fps updates
```

### 2. 减少渲染复杂度
- 使用简单几何图形而非复杂精灵
- 限制地图大小
- 优化 tilemap 图层数量

## 联系支持

如果问题依然存在：
1. 检查浏览器控制台完整错误信息
2. 确认 Node.js 版本 >= 16
3. 确认网络连接正常
4. 尝试重启开发服务器

## 已知限制

1. **Croquet 免费版限制**: 最多10个并发用户
2. **浏览器兼容性**: 需要现代浏览器支持 ES6+
3. **网络依赖**: 多人功能需要稳定网络连接
4. **性能**: 大量玩家时可能影响性能